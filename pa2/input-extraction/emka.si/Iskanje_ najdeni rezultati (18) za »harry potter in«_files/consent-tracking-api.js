!function(n){"use strict";const e="trackingConsentAccepted",t="trackingConsentDeclined",o="firstPartyMarketingConsentAccepted",r="thirdPartyMarketingConsentAccepted",c="analyticsConsentAccepted",i="preferencesConsentAccepted",s="firstPartyMarketingConsentDeclined",a="thirdPartyMarketingConsentDeclined",u="analyticsConsentDeclined",l="preferencesConsentDeclined",f="visitorConsentCollected",d="consentTrackingApiLoaded",p="yes",g="no",y="no_interaction",h="",w="",m="1",C="0",k={GDPR:"GDPR",CCPA:"CCPA",NO_VALUE:""},b="p",v="a",P="m",A="t",O="m",S="a",_="p",j="s",T="marketing",R="analytics",D="preferences",E="sale_of_data",M="email",I="headlessStorefront",U="rootDomain",B="checkoutRootDomain",N="storefrontRootDomain",x="storefrontAccessToken",q="isExtensionToken",J="metafields",V=["v","con","reg"];function L(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,o)}return t}function H(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?L(Object(t),!0).forEach((function(e){G(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):L(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function G(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function X(n){return function(n){const e=document.cookie?document.cookie.split("; "):[];for(let t=0;t<e.length;t++){const[o,r]=e[t].split("=");if(n===decodeURIComponent(o)){return JSON.parse(decodeURIComponent(r))}}}(n)}function K(n){return n===encodeURIComponent(decodeURIComponent(n))}function z(n,e,t,o){if(!K(o))throw new TypeError("Cookie value is not correctly URI encoded.");if(!K(n))throw new TypeError("Cookie name is not correctly URI encoded.");let r="".concat(n,"=").concat(o);r+="; path=/",e&&(r+="; domain=".concat(e)),r+="; expires=".concat(new Date((new Date).getTime()+t).toUTCString()),r+="; secure",document.cookie=r}function F(){const n=X("_tracking_consent");if(void 0!==n&&!function(n){if("2.1"!==n.v)return!0;return!function(n,e){const t=e.slice().sort();return n.length===e.length&&n.slice().sort().every((n,e)=>n===t[e])}(Object.keys(n).filter(n=>"region"!==n&&"lim"!==n&&"cus"!==n),V)}(n))return n}function Q(){try{let n=F();if(!n)return;return n}catch(n){return}}function W(){return{m:en(O),a:en(S),p:en(_),s:en(j)}}function Y(){return W()[j]}function Z(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===n&&(n=Q()),void 0===n}function $(n){switch(n){case m:return p;case C:return g;default:return h}}function nn(n){switch(n){case S:return R;case O:return T;case _:return D;case j:return E}}function en(n){const e=Q();if(!e)return w;const t=e.con.CMP;return t?t[n]:w}function tn(){return X("_cmp_a")}function on(n){const e=tn();if(!e)return!0;const t=e.purposes[n];return"boolean"!=typeof t||t}function rn(){return on(b)}function cn(){return on(v)}function sn(){return on(P)}function an(){return on(A)}function un(){const n=tn();return!!n&&("boolean"==typeof n.display_banner&&n.display_banner)}function ln(){const n=tn();return n&&n.sale_of_data_region||!1}function fn(n){void 0!==n.consent?pn({[b]:n.consent,[v]:n.consent,[P]:n.consent,[A]:n.consent}):void 0!==n.granular_consent&&pn({[b]:rn(),[v]:cn(),[P]:sn(),[A]:an()})}function dn(n,e){document.dispatchEvent(new CustomEvent(n,{detail:e||{}}))}function pn(n){const d=n[P],p=n[A],g=n[v],y=n[b];!0===d?dn(o):!1===d&&dn(s),!0===p?dn(r):!1===p&&dn(a),!0===g?dn(c):!1===g&&dn(u),!0===y?dn(i):!1===y&&dn(l);const h=function(n){return{marketingAllowed:n[P],saleOfDataAllowed:n[A],analyticsAllowed:n[v],preferencesAllowed:n[b],firstPartyMarketingAllowed:n[P],thirdPartyMarketingAllowed:n[A]}}(n);dn(f,h);const w=[g,y,d,p];w.every(n=>!0===n)&&dn(e),w.every(n=>!1===n)&&dn(t)}function gn(n,e){const t=new XMLHttpRequest,o=JSON.stringify(n);function r(o,r){if(4!==t.readyState)return;const c=function(n){try{return JSON.parse(n)}catch(n){return{error:"Unknown error"}}}(t.responseText);var i;0===(i=t.status)||200>=i&&i<400?(fn(n),void 0!==e&&e(null,c),o(c)):(void 0!==e&&e(c),r({response:c,code:t.status}))}return t.open("POST","/set_tracking_consent.json",!0),t.setRequestHeader("Content-Type","application/json"),e?(t.onreadystatechange=()=>r(n=>{},n=>{}),void t.send(o)):new Promise((n,e)=>{t.onreadystatechange=()=>r(n,e),t.send(o)})}function yn(n){const e=function n(e,t){if(null===e)return"null";if(Array.isArray(e)){const t=e.map(e=>n(e,!0)).join(",");return"[".concat(t,"]")}if("object"==typeof e){let o=[];for(const t in e)e.hasOwnProperty(t)&&void 0!==e[t]&&o.push("".concat(t,":").concat(n(e[t],!0)));const r=o.join(",");return t?"{".concat(r,"}"):r}return"string"==typeof e?'"'.concat(e,'"'):"".concat(e)}({visitorConsent:H({marketing:n.marketing,analytics:n.analytics,preferences:n.preferences,saleOfData:n.sale_of_data},n.metafields&&{metafields:n.metafields})});return{query:"query { consentManagement { cookies(".concat(e,") { answersCookie trackingConsentCookie } } }"),variables:{}}}function hn(n,e){const t=n.granular_consent,o=t.storefrontAccessToken||function(){const n=document.documentElement.querySelector("#shopify-features"),e="Could not find liquid access token";if(!n)return void console.warn(e);const t=JSON.parse(n.textContent||"").accessToken;if(!t)return void console.warn(e);return t}(),r=t.checkoutRootDomain||window.location.host,c={headers:{"content-type":"application/json",[t.isExtensionToken?"Shopify-Storefront-Extension-Token":"x-shopify-storefront-access-token"]:o},body:JSON.stringify(yn(t)),method:"POST"};return fetch("https://".concat(r,"/api/unstable/graphql.json"),c).then(n=>{if(n.ok)return n.json();throw new Error("Server error")}).then(o=>{const r="."+(t.checkoutRootDomain||window.location.hostname),c="."+(t.storefrontRootDomain||window.location.hostname),i=o.data.consentManagement.cookies.trackingConsentCookie,s=o.data.consentManagement.cookies.answersCookie;return z("_tracking_consent",r,31536e6,i),z("_cmp_a",r,31536e6,s),c!==r&&(z("_tracking_consent",c,31536e6,i),z("_cmp_a",c,31536e6,s)),fn(n),void 0!==e&&e(null,o),o}).catch(n=>{const t="Error while setting storefront API consent: "+n.message;if(void 0===e)throw{error:t};e({error:t})})}function wn(n,e){if(Z()&&console.warn("Shop is not configured to block privacy regulation in online store settings."),function(n){if("boolean"!=typeof n&&"object"!=typeof n)throw TypeError("setTrackingConsent must be called with a boolean or object consent value");if("object"==typeof n){const e=Object.keys(n);if(0===e.length)throw TypeError("The submitted consent object is empty.");const t=[T,R,D,E,M,U,B,N,x,I,q,J];for(const n of e)if(!t.includes(n))throw TypeError("The submitted consent object should only contain the following keys: ".concat(t.join(", "),". Extraneous key: ").concat(n,"."))}}(n),void 0!==e&&"function"!=typeof e)throw TypeError("setTrackingConsent must be called with a callback function if the callback argument is provided");if("object"==typeof n){const t=vn(n.analytics),o=Pn(n.analytics);return(n.storefrontAccessToken||n.metafields?hn:gn)(H(H({granular_consent:n},null!==t&&{referrer:t}),null!==o&&{landing_page:o}),e)}{const t=vn(n),o=Pn(n);return gn(H(H({consent:n},null!==t&&{referrer:t}),null!==o&&{landing_page:o}),e)}}function mn(n,e){if("boolean"!=typeof n)throw TypeError("setCCPAConsent must be called with a boolean consent value");if("function"!=typeof e)throw TypeError("setCCPAConsent must be called with a callback function");return gn({ccpa_consent:n},e)}function Cn(){if(Z())return h;const n=W();return n[O]===m&&n[S]===m?p:n[O]===C||n[S]===C?g:y}function kn(){const n=function(){const n=Q();return Z(n)?k.NO_VALUE:n.reg}();return n in k?n:k.NO_VALUE}function bn(){return console.warn("getShopPrefs is deprecated and will be removed."),{limit:[]}}function vn(n){return n?On()?document.referrer:"":null}function Pn(n){return n?On()?window.location.pathname+window.location.search:"/":null}function An(){return function(){const n=Q();return Z(n)?"":n.region||""}()}function On(){if(""===document.referrer)return!0;const n=document.createElement("a");return n.href=document.referrer,window.location.hostname!=n.hostname}function Sn(){return console.warn("isRegulationEnforced is deprecated and will be removed."),!0}function _n(){return!!Z()||sn()&&cn()}function jn(){return ln()?"string"==typeof navigator.globalPrivacyControl?"1"!==navigator.globalPrivacyControl:"boolean"==typeof navigator.globalPrivacyControl?!navigator.globalPrivacyControl:null:null}function Tn(){return console.warn("userDataCanBeSold is deprecated and will be replaced with saleOfDataAllowed."),an()}function Rn(){return un()&&Cn()===y}function Dn(){return!1===jn()?g:(n=Y(),Z()?h:n===w?y:$(n));var n}function En(){return console.warn("shouldShowCCPABanner is deprecated and will be removed."),ln()&&Dn()===y}function Mn(){return!0}function In(n){return function(n){const e=Q();if(Z(e)||!e.cus)return;const t=e.cus[encodeURIComponent(n)];return t?decodeURIComponent(t):t}(n)}function Un(n,e,t){try{var o;!function(n){const e=new XMLHttpRequest;e.open("POST","https://notify.bugsnag.com/",!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Bugsnag-Api-Key","95ba910bcec4542ef2a0b64cd7ca666c"),e.setRequestHeader("Bugsnag-Payload-Version","5");const t=function(n){const e=function(n){return n.stackTrace||n.stack||n.description||n.name}(n.error),[t,o]=(e||"unknown error").split("\n")[0].split(":");return JSON.stringify({payloadVersion:5,notifier:{name:"ConsentTrackingAPI",version:"latest",url:"-"},events:[{exceptions:[{errorClass:(t||"").trim(),message:(o||"").trim(),stacktrace:[{file:"consent-tracking-api.js",lineNumber:"1",method:e}],type:"browserjs"}],context:n.context||"general",app:{id:"ConsentTrackingAPI",version:"latest"},metaData:{request:{shopId:n.shopId,shopUrl:window.location.href},device:{userAgent:window.navigator.userAgent},"Additional Notes":n.notes},unhandled:!1}]})}(n);e.send(t)}({error:n,context:e,shopId:Nn()||(null===(o=window.Shopify)||void 0===o?void 0:o.shop),notes:t})}catch(n){}}function Bn(n){return function(){try{return n(...arguments)}catch(n){throw Un(n),n}}}function Nn(){try{const n=document.getElementById("shopify-features").textContent;return JSON.parse(n).shopId}catch(n){return null}}function xn(){return sn()}function qn(){return an()}function Jn(){const n={},e=W();for(const t of Object.keys(e))n[nn(t)]=$(e[t]);return n}function Vn(n,e){return"object"==typeof n&&n.headlessStorefront&&!n.storefrontAccessToken?function(n,e){function t(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w;return!0===n?m:!1===n?C:e}const o={[S]:t(n[R],C),[O]:t(n[T],C),[_]:t(n[D],C),[j]:t(n[E])},r={v:"2.1",reg:k.NO_VALUE,con:{CMP:o}},c=encodeURIComponent(JSON.stringify(r));return z("_tracking_consent",n.rootDomain,31536e6,c),e(null),new Promise((n,e)=>{})}(n,e||(()=>{})):wn(n,e)}const Ln=n=>{let{useBugsnagReporting:e}=n;Y()!=C&&!1===jn()&&mn(!1,()=>!1);const t={getTrackingConsent:Cn,setTrackingConsent:Vn,userCanBeTracked:_n,getRegulation:kn,isRegulationEnforced:Sn,getShopPrefs:bn,shouldShowGDPRBanner:Rn,userDataCanBeSold:Tn,setCCPAConsent:mn,getCCPAConsent:Dn,shouldShowCCPABanner:En,doesMerchantSupportGranularConsent:Mn,analyticsProcessingAllowed:cn,preferencesProcessingAllowed:rn,marketingAllowed:xn,firstPartyMarketingAllowed:xn,saleOfDataAllowed:qn,thirdPartyMarketingAllowed:qn,currentVisitorConsent:Jn,shouldShowBanner:un,saleOfDataRegion:ln,getRegion:An,getTrackingConsentMetafield:In,unstable:{analyticsProcessingAllowed:cn,preferencesProcessingAllowed:rn,marketingAllowed:xn,saleOfDataAllowed:qn,currentVisitorConsent:Jn,shouldShowBanner:un,saleOfDataRegion:ln}};if(!e)return t;const o=["unstable"];for(const n in t)t.hasOwnProperty(n)&&(t[n]=o.includes(n)?t[n]:Bn(t[n]));return t};function Hn(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{useBugsnagReporting:!1};return Ln(n)}function Gn(){window.Shopify.customerPrivacy=window.Shopify.trackingConsent=Hn({useBugsnagReporting:!0}),dn(d)}window.Shopify=window.Shopify?window.Shopify:{},Gn(),n.default=Hn,n.setGlobalObject=Gn,Object.defineProperty(n,"__esModule",{value:!0})}({});
//# sourceMappingURL=consent-tracking-api.js.map

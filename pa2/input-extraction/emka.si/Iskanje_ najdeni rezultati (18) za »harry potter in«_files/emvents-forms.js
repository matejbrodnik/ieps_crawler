(()=>{"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var n=function(){function t(r){e(this,t),this.status_code=r.status,this.status_text=r.status_text,this.content=r.responseText,this.rawHeaders=r.getAllResponseHeaders()}return r(t,[{key:"headers",get:function(){var e,t;return void 0===this._headers&&(this._headers=(e=this.rawHeaders,t={},e.split("\r\n").forEach((function(e){if(e.length>0){var r=e.split(": ");t[r.shift().toLowerCase()]=r.join(": ")}})),t)),this._headers}},{key:"json",value:function(){return JSON.parse(this.content)}}]),t}();const o=new(function(){function t(){e(this,t)}return r(t,[{key:"get",value:function(e){return e.method="GET",this.request(e)}},{key:"post",value:function(e){return e.method="POST",this.request(e)}},{key:"request",value:function(e){return new Promise((function(t,r){var o=new XMLHttpRequest,a=e.url;e.params&&(a="".concat(a,"?").concat(new URLSearchParams(e.params).toString())),o.open(e.method,a,!0),o.onreadystatechange=function(){o.readyState>3&&(200==o.status||201==o.status?t(new n(o)):r(new n(o)))},e.headers&&Object.keys(e.headers).forEach((function(t){o.setRequestHeader(t,e.headers[t])})),e.data?o.send(e.data):o.send()}))}}]),t}());function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(e){e.querySelectorAll("[data-emvents-msg-type]").forEach((function(e){e.style.display="none"}))}function i(e){e.querySelectorAll(".formbuilder-field-error").forEach((function(e){e.style.display="none"}))}document.addEventListener("DOMContentLoaded",(function e(){document.removeEventListener("DOMContentLoaded",e,!1);var t=document.querySelectorAll("form[data-emvents-event]"),r=document.querySelectorAll('[class="formbuilder-field-error"]');t.forEach((function(e){s(e)})),r.forEach((function(e){i(e)})),document.querySelectorAll("[data-emvents-form]").forEach((function(e){var t=e.getAttribute("data-emvents-form"),r=new URL(document.querySelector('script[src*="emvents-forms.js"]').getAttribute("src"));o.get({url:"".concat(r.origin,"/form/").concat(t,"/html/")}).then((function(r){e.innerHTML=r.content,s(e.querySelector('[data-emvents-form="'.concat(t,'"')))})).catch((function(e){}))}))})),document.addEventListener("submit",(function(e){if(e.target.matches("form[data-emvents-event]")){var t=e.target,r=new URL(document.querySelector('script[src*="emvents-forms.js"]').getAttribute("src"));e.preventDefault(),e.submitter.disabled=!0,s(t),i(t);var n=t.getAttribute("data-emvents-event"),c=t.getAttribute("data-emvents-form"),u=(f=e.target,d={},new FormData(f).forEach((function(e,t){if(Object.prototype.hasOwnProperty.call(d,t)){var r=d[t];Array.isArray(r)||(r=d[t]=[r]),r.push(e)}else d[t]=e})),d),l={"Content-Type":"application/json"};c&&(l["Emvents-Form"]=c),o.post({url:"".concat(r.origin,"/event/").concat(n,"/trigger/"),headers:l,data:JSON.stringify(u)}).then((function(r){var n=t.getAttribute("data-emvents-redirect");n?window.location.href=n:(e.submitter.style.display="none",t.querySelector('[data-emvents-msg-type="success"]').style.display=null,i(t))})).catch((function(r){var n;if(e.submitter.disabled=!1,400==r.status_code){n='[data-emvents-msg-type="validation"]';var o=r.json();Object.entries(o).forEach((function(e){var r,n,o=(n=2,function(e){if(Array.isArray(e))return e}(r=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a=[],s=!0,i=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);s=!0);}catch(e){i=!0,o=e}finally{try{s||null==r.return||r.return()}finally{if(i)throw o}}return a}}(r,n)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=o[0],i=o[1],c=t.querySelector('[name="'.concat(s,'"]')),u=document.createElement("div");u.classList.add("formbuilder-field-error"),u.innerHTML=i.join(" "),c.after(u),console.log(s,c,i)}))}else n='[data-emvents-msg-type="error"]';t.querySelector(n).style.display=null}))}var f,d}))})();